---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - app/globals.css
  - app/components/layout/PageTransition.tsx
  - app/components/layout/Navbar.tsx
autonomous: true

must_haves:
  truths:
    - "Lighthouse no longer flags H1UserAgentFontSizeInSection warning"
    - "User can navigate entire site using keyboard with visible focus indicators on every interactive element"
    - "Animations respect user's prefers-reduced-motion setting (no motion when disabled)"
  artifacts:
    - path: "app/globals.css"
      provides: "H1 sizing, focus indicators, reduced motion media query"
      contains: ":where(h1)"
    - path: "app/components/layout/PageTransition.tsx"
      provides: "Reduced motion support for page transitions"
      contains: "useReducedMotion"
    - path: "app/components/layout/Navbar.tsx"
      provides: "Reduced motion support for mobile menu animations"
      contains: "useReducedMotion"
  key_links:
    - from: "app/globals.css"
      to: "browser"
      via: ":focus-visible pseudo-class"
      pattern: ":focus-visible"
    - from: "app/globals.css"
      to: "browser"
      via: "prefers-reduced-motion media query"
      pattern: "@media.*prefers-reduced-motion"
    - from: "app/components/layout/PageTransition.tsx"
      to: "framer-motion"
      via: "useReducedMotion hook"
      pattern: "useReducedMotion"
---

<objective>
Implement accessibility fixes for H1 font sizing, focus indicators, and prefers-reduced-motion support.

Purpose: Address Lighthouse warnings and ensure the site is accessible to keyboard users and users who prefer reduced motion. These are foundational accessibility requirements that all subsequent work benefits from.

Output: Updated globals.css with H1 sizing fix, global focus-visible styles with double-layered outline, and reduced motion media query. Updated PageTransition.tsx and Navbar.tsx with useReducedMotion hook integration.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@app/globals.css
@app/components/layout/PageTransition.tsx
@app/components/layout/Navbar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add H1 sizing, focus indicators, and reduced motion CSS to globals.css</name>
  <files>app/globals.css</files>
  <action>
Add three CSS blocks after the :root block and before the body selector in globals.css:

1. **Add H1 explicit sizing fix** (fixes A11Y-01 Lighthouse warning):
   ```css
   /* =========================
      H1 EXPLICIT SIZING
      Fixes H1UserAgentFontSizeInSection Lighthouse warning
      Uses :where() for zero specificity - won't override component styles
      Source: MDN Blog - H1 element styles
      ========================= */
   :where(h1) {
     font-size: 2em;
     margin-block: 0.67em;
   }
   ```

2. **Add global focus indicators** (fixes A11Y-02):
   ```css
   /* =========================
      FOCUS INDICATORS
      Two-color focus ring visible on both light and dark backgrounds
      Source: W3C WCAG Technique C40
      ========================= */
   :focus-visible {
     outline: var(--focus-ring-width) solid var(--focus-ring-color);
     outline-offset: var(--focus-ring-offset);
     box-shadow: 0 0 0 calc(var(--focus-ring-width) + var(--focus-ring-offset)) var(--focus-shadow-color);
   }

   /* Remove default outline for mouse users (keep for keyboard) */
   :focus:not(:focus-visible) {
     outline: none;
   }
   ```

3. **Add reduced motion media query** (fixes A11Y-04 for CSS animations):
   ```css
   /* =========================
      REDUCED MOTION SUPPORT
      Respects user's prefers-reduced-motion setting
      Note: Keeps instant transitions for state feedback (opacity/color)
      Source: W3C WCAG Technique C39
      ========================= */
   @media (prefers-reduced-motion: reduce) {
     *,
     *::before,
     *::after {
       animation-duration: 0.01ms !important;
       animation-iteration-count: 1 !important;
       transition-duration: 0.01ms !important;
       scroll-behavior: auto !important;
     }
   }
   ```

Place these blocks in order: @tailwind directives -> :root -> H1 sizing -> focus indicators -> reduced motion -> body -> @layer utilities -> component styles.

Important: The focus tokens (--focus-ring-width, --focus-ring-color, etc.) were added in Plan 01. Verify they exist before proceeding.
  </action>
  <verify>
Run `npm run build` to verify no CSS parsing errors. In dev server:
1. Tab through the page - focus rings should be visible on all interactive elements
2. Check Lighthouse accessibility audit - H1 warning should be gone
3. Enable "Reduce motion" in OS settings - CSS animations should be instant
  </verify>
  <done>
globals.css contains :where(h1) block with explicit sizing, :focus-visible block with two-color outline pattern, and @media (prefers-reduced-motion: reduce) block. All three blocks use semantic tokens where applicable. Build succeeds.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add useReducedMotion to PageTransition.tsx</name>
  <files>app/components/layout/PageTransition.tsx</files>
  <action>
Update PageTransition.tsx to respect prefers-reduced-motion for Framer Motion animations:

1. **Import useReducedMotion** from framer-motion:
   ```typescript
   import { AnimatePresence, motion, useReducedMotion } from "framer-motion";
   ```

2. **Add the hook call** at the top of the component function:
   ```typescript
   const PageTransition = ({ children }: PageTransitionProps) => {
     const pathname = usePathname();
     const shouldReduceMotion = useReducedMotion();
   ```

3. **Update motion.div props** to conditionally disable motion:
   ```typescript
   <motion.div
     key={pathname}
     initial={{ opacity: 0, y: shouldReduceMotion ? 0 : 20 }}
     animate={{ opacity: 1, y: 0 }}
     exit={{ opacity: 0, y: shouldReduceMotion ? 0 : -20 }}
     transition={{
       duration: shouldReduceMotion ? 0 : 0.3,
       ease: "easeInOut",
     }}
   >
   ```

The key principle: Keep opacity transitions (instant is fine), remove y-axis movement when reduced motion is preferred. Users still see content appear, just without the sliding motion.
  </action>
  <verify>
1. Enable "Reduce motion" in macOS System Settings > Accessibility > Display
2. Navigate between pages in dev server
3. Verify pages appear instantly without sliding animation
4. Verify opacity still fades (or appears instant, both acceptable)
5. Disable reduced motion - verify animations return
  </verify>
  <done>
PageTransition.tsx imports useReducedMotion from framer-motion, calls the hook in the component, and conditionally sets y values and duration to 0 when shouldReduceMotion is true. Component respects OS preference.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add useReducedMotion to Navbar.tsx mobile menu</name>
  <files>app/components/layout/Navbar.tsx</files>
  <action>
Update Navbar.tsx to respect prefers-reduced-motion for mobile menu animations:

1. **Import useReducedMotion** from framer-motion:
   ```typescript
   import { motion, AnimatePresence, useReducedMotion } from "framer-motion";
   ```

2. **Add the hook call** at the top of the component function:
   ```typescript
   const Navbar = () => {
     const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
     const pathname = usePathname();
     const shouldReduceMotion = useReducedMotion();
   ```

3. **Update hamburger icon animation** (lines 71-83) to conditionally animate:
   ```typescript
   <motion.span
     animate={
       isMobileMenuOpen
         ? { rotate: 45, y: 8 }
         : { rotate: 0, y: 0 }
     }
     transition={{ duration: shouldReduceMotion ? 0 : 0.2 }}
     className="w-full h-0.5 bg-current transform origin-center"
   />
   <motion.span
     animate={isMobileMenuOpen ? { opacity: 0 } : { opacity: 1 }}
     transition={{ duration: shouldReduceMotion ? 0 : 0.2 }}
     className="w-full h-0.5 bg-current"
   />
   <motion.span
     animate={
       isMobileMenuOpen
         ? { rotate: -45, y: -8 }
         : { rotate: 0, y: 0 }
     }
     transition={{ duration: shouldReduceMotion ? 0 : 0.2 }}
     className="w-full h-0.5 bg-current transform origin-center"
   />
   ```

4. **Update mobile menu slide animation** (line 91-96) to use instant transitions:
   ```typescript
   <motion.div
     initial={{ x: shouldReduceMotion ? 0 : "100%", opacity: 0 }}
     animate={{ x: 0, opacity: 1 }}
     exit={{ x: shouldReduceMotion ? 0 : "100%", opacity: 0 }}
     transition={
       shouldReduceMotion
         ? { duration: 0 }
         : { type: "spring", stiffness: 300, damping: 30 }
     }
     className="fixed top-16 right-0 h-[calc(100vh-4rem)] w-64 bg-card-bg border-l border-text-secondary/10 shadow-xl md:hidden"
   >
   ```

5. **Update overlay fade** (line 124-128) similarly:
   ```typescript
   <motion.div
     initial={{ opacity: 0 }}
     animate={{ opacity: 1 }}
     exit={{ opacity: 0 }}
     transition={{ duration: shouldReduceMotion ? 0 : 0.2 }}
     onClick={closeMobileMenu}
     className="fixed inset-0 top-16 bg-black/50 backdrop-blur-sm md:hidden z-40"
   />
   ```

The key principle: When reduced motion is preferred, the menu and hamburger still work, they just appear/disappear instantly instead of sliding/rotating.
  </action>
  <verify>
1. Enable "Reduce motion" in macOS System Settings > Accessibility > Display
2. Open dev server on mobile viewport (or resize browser)
3. Click hamburger menu
4. Verify menu appears instantly without sliding animation
5. Verify hamburger transforms to X instantly
6. Verify overlay appears instantly
7. Disable reduced motion - verify animations return
  </verify>
  <done>
Navbar.tsx imports useReducedMotion, calls the hook in the component, and conditionally disables motion for: hamburger icon rotation, mobile menu slide-in, and overlay fade. All animations respect OS preference.
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify all Phase 1 success criteria:

1. **A11Y-01 (H1 sizing):** Run Lighthouse accessibility audit - no H1UserAgentFontSizeInSection warning
2. **A11Y-02 (Focus indicators):** Tab through entire site - every interactive element (links, buttons, form inputs) shows visible focus ring
3. **A11Y-04 (Reduced motion):**
   - Enable OS reduced motion preference
   - Navigate between pages - no slide animations
   - Open mobile menu - no slide animation
   - CSS marquee animation (if visible) should not animate
4. **COLOR-02 (Token architecture):** Verified in Plan 01 - semantic tokens in place

Full verification command:
```bash
npm run build && npm run dev
# Then test in browser with keyboard and reduced motion settings
```
</verification>

<success_criteria>
- Lighthouse no longer flags H1UserAgentFontSizeInSection warning
- User can navigate entire site using keyboard with visible focus indicators on every interactive element
- Animations respect user's prefers-reduced-motion setting (no motion when disabled)
- All CSS and TypeScript builds succeed without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md` following the summary template.
</output>
