---
phase: 05-motion-scroll
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/components/animation/variants.ts
  - app/components/layout/PageTransition.tsx
autonomous: true

must_haves:
  truths:
    - "Page transition animation plays exactly once on navigation"
    - "Page transition animation does not replay on hydration"
    - "Reduced motion users see instant opacity transitions"
  artifacts:
    - path: "app/components/animation/variants.ts"
      provides: "Centralized animation variant definitions"
      exports: ["fadeUpVariants", "staggerContainerVariants", "staggerItemVariants", "reducedFadeVariants", "reducedContainerVariants", "reducedItemVariants", "pageTransitionVariants", "reducedPageTransitionVariants"]
    - path: "app/components/layout/PageTransition.tsx"
      provides: "Fixed page transition with FrozenRouter pattern"
      contains: "useSelectedLayoutSegment"
  key_links:
    - from: "app/components/layout/PageTransition.tsx"
      to: "app/components/animation/variants.ts"
      via: "import variants"
      pattern: "import.*variants"
    - from: "app/components/layout/PageTransition.tsx"
      to: "next/navigation"
      via: "useSelectedLayoutSegment"
      pattern: "useSelectedLayoutSegment"
---

<objective>
Create animation foundation and fix page transition hydration bug.

Purpose: Establish centralized animation variants for consistency and fix the pending todo from STATE.md - page transition animation plays twice on page load due to hydration.

Output: Working page transitions that play once, shared variants file for scroll animations.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-motion-scroll/05-RESEARCH.md

@app/components/layout/PageTransition.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create centralized animation variants</name>
  <files>app/components/animation/variants.ts</files>
  <action>
Create `app/components/animation/variants.ts` with typed Framer Motion variants.

Include these variant sets (all with TypeScript `Variants` type):

1. **fadeUpVariants** - Standard section reveal (fade + slide up)
   - hidden: opacity 0, y: 20
   - visible: opacity 1, y: 0, duration 0.5s, ease "easeOut"

2. **staggerContainerVariants** - Container for staggered children
   - hidden: opacity 0
   - visible: opacity 1, staggerChildren 0.1, delayChildren 0.1

3. **staggerItemVariants** - Individual staggered item
   - hidden: opacity 0, y: 20
   - visible: opacity 1, y: 0, duration 0.4s, ease "easeOut"

4. **reducedFadeVariants** - Reduced motion section reveal
   - hidden: opacity 0
   - visible: opacity 1, duration 0.01 (per Phase 1 decision - not 0)

5. **reducedContainerVariants** - Reduced motion container
   - hidden: opacity 0
   - visible: opacity 1, duration 0.01

6. **reducedItemVariants** - Reduced motion item
   - hidden: opacity 0
   - visible: opacity 1 (no transition needed, inherits from container)

7. **pageTransitionVariants** - Page transition
   - initial: opacity 0, y: 20
   - animate: opacity 1, y: 0
   - exit: opacity 0, y: -20

8. **reducedPageTransitionVariants** - Reduced motion page transition
   - initial: opacity 0
   - animate: opacity 1
   - exit: opacity 0

Use named exports for all variants. Do not add "use client" - this is a pure data file.
  </action>
  <verify>File exists at `app/components/animation/variants.ts` with all 8 exported variant objects</verify>
  <done>Centralized variants file exists with typed exports for both standard and reduced motion variants</done>
</task>

<task type="auto">
  <name>Task 2: Fix PageTransition hydration bug with FrozenRouter</name>
  <files>app/components/layout/PageTransition.tsx</files>
  <action>
Refactor PageTransition.tsx to fix the hydration animation replay bug.

Key changes:
1. Replace `usePathname()` with `useSelectedLayoutSegment()` from "next/navigation"
2. Add `LayoutRouterContext` import from "next/dist/shared/lib/app-router-context.shared-runtime"
3. Implement `usePreviousValue<T>` hook to track previous values across renders
4. Implement `FrozenRouter` component that freezes router context during exit animations
5. Import and use variants from "../animation/variants"
6. Use `useReducedMotion()` to select between standard and reduced motion variants

Implementation pattern (from research):
```typescript
function usePreviousValue<T>(value: T): T | undefined {
  const prevValue = useRef<T>();
  useEffect(() => {
    prevValue.current = value;
    return () => { prevValue.current = undefined; };
  });
  return prevValue.current;
}

function FrozenRouter({ children }: { children: React.ReactNode }) {
  const context = useContext(LayoutRouterContext);
  const prevContext = usePreviousValue(context) || null;
  const segment = useSelectedLayoutSegment();
  const prevSegment = usePreviousValue(segment);
  const changed = segment !== prevSegment &&
                  segment !== undefined &&
                  prevSegment !== undefined;

  return (
    <LayoutRouterContext.Provider value={changed ? prevContext : context}>
      {children}
    </LayoutRouterContext.Provider>
  );
}
```

The PageTransition component should:
- Use `segment` as the motion.div key (not pathname)
- Keep `initial={false}` on AnimatePresence to prevent initial animation
- Keep `mode="wait"` on AnimatePresence
- Wrap children in FrozenRouter
- Use 0.01 duration for reduced motion (per Phase 1 decision, not 0)
- Use 0.3s duration and "easeInOut" ease for normal transitions
  </action>
  <verify>
1. Run `npm run build` - should complete without errors
2. Run `npm run dev`, navigate between pages - animation should play once per navigation
3. Refresh page - no animation should play on initial load (initial={false})
  </verify>
  <done>Page transition uses FrozenRouter pattern with useSelectedLayoutSegment key, animation plays exactly once per navigation</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without TypeScript errors
2. Navigate from home to /projects - single smooth transition animation
3. Navigate from /projects to /experience - single smooth transition animation
4. Refresh any page - no transition animation on load
5. Enable prefers-reduced-motion in browser - transitions are instant (0.01ms)
</verification>

<success_criteria>
1. app/components/animation/variants.ts exists with 8 exported variant objects
2. PageTransition uses useSelectedLayoutSegment instead of usePathname
3. FrozenRouter component implemented and wrapping children
4. Page transitions play exactly once per navigation (no hydration replay)
5. Reduced motion respected with 0.01ms duration
</success_criteria>

<output>
After completion, create `.planning/phases/05-motion-scroll/05-01-SUMMARY.md`
</output>
